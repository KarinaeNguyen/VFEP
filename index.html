// assets/js/importSections.js - Phi√™n b·∫£n ƒê√£ S·ª≠a L·ªói

// ... (C√°c ƒë·ªëi t∆∞·ª£ng LANGUAGE_DATA v√† bi·∫øn currentLang ƒë∆∞·ª£c gi·ªØ nguy√™n) ...
const LANGUAGE_DATA = {
    'vi': {
        // ... (N·ªôi dung d·ªãch ti·∫øng Vi·ªát) ...
        'page_title': 'Vicinity Safety | C√¥ng Ngh·ªá D·∫≠p L·ª≠a Ch√≠nh X√°c VFEP',
        'header_title': 'T√†i li·ªáu K·∫ø ho·∫°ch Kinh doanh',
        'language_switch': 'English',
        'language_current': 'VN',
        'nav_overview': 'T·ªïng quan',
        'nav_vision': 'T·∫ßm nh√¨n & S·ª© m·ªánh',
        'nav_lean_canvas': 'M√¥ h√¨nh Lean Canvas',
        'nav_technology': 'C√¥ng ngh·ªá',
        'nav_strategy': 'Chi·∫øn l∆∞·ª£c',
        'nav_market': 'Ph√¢n t√≠ch Th·ªã tr∆∞·ªùng',
        'nav_financials': 'T√†i ch√≠nh',
        'nav_advantage': 'L·ª£i th·∫ø C·∫°nh tranh',
        'footer_text': '¬© 2024 Vicinity Safety. B·∫£o l∆∞u m·ªçi quy·ªÅn.',
    },
    'en': {
        // ... (N·ªôi dung d·ªãch ti·∫øng Anh) ...
        'page_title': 'Vicinity Safety | Precise Fire Extinguishing Technology VFEP',
        'header_title': 'Business Plan Document',
        'language_switch': 'Ti·∫øng Vi·ªát',
        'language_current': 'EN',
        'nav_overview': 'Overview',
        'nav_vision': 'Vision & Mission',
        'nav_lean_canvas': 'Lean Canvas Model',
        'nav_technology': 'Technology',
        'nav_strategy': 'Strategy',
        'nav_market': 'Market Analysis',
        'nav_financials': 'Financials',
        'nav_advantage': 'Competitive Advantage',
        'footer_text': '¬© 2024 Vicinity Safety. All rights reserved.',
    }
};

let currentLang = localStorage.getItem('lang') || 'vi';

async function importSections() {
    const sections = [
        'header', 'overview', 'vision', 'lean-canvas', 'technology', 
        'strategy', 'market', 'financials', 'advantage', 'footer'
    ];

    for (const section of sections) {
        const path = `sections/${section}.html`; 
        try {
            const response = await fetch(path);
            if (response.ok) {
                const html = await response.text();
                document.getElementById(section).innerHTML = html;
            } else {
                console.error(`Failed to load section: ${path}`);
            }
        } catch (error) {
            console.error(`Error fetching section ${section}:`, error);
        }
    }
    
    // 1. √ÅP D·ª§NG B·∫¢N D·ªäCH SAU KHI T·∫¢I
    applyTranslations(currentLang);
    
    // üî• FIX L·ªñI S·ªê 1: G·ªåI initializeApp() trong main.js sau khi t·∫£i v√† d·ªãch
    if (typeof window.initializeApp === 'function') {
        window.initializeApp();
    } else {
        console.error('CRITICAL ERROR: initializeApp() not found. main.js not loaded or defined.');
    }
}


window.switchLanguage = function(lang) {
    if (lang === currentLang) return; 

    currentLang = lang;
    localStorage.setItem('lang', lang);
    
    document.documentElement.lang = lang;
    document.title = LANGUAGE_DATA[lang]['page_title'];

    applyTranslations(lang);
};

function applyTranslations(lang) {
    // A. D·ªãch n·ªôi dung tƒ©nh/t·∫£i v·ªÅ
    document.querySelectorAll('[data-key]').forEach(element => {
        const key = element.getAttribute('data-key');
        const translation = LANGUAGE_DATA[lang][key];
        if (translation) {
            // üî• FIX L·ªñI S·ªê 2: D√πng innerHTML thay cho textContent ƒë·ªÉ gi·ªØ ƒë·ªãnh d·∫°ng HTML
            element.innerHTML = translation; 
        }
    });

    // B. C·∫≠p nh·∫≠t n√∫t chuy·ªÉn ƒë·ªïi ng√¥n ng·ªØ/hi·ªÉn th·ªã
    const switchBtn = document.getElementById('language-switch-btn');
    const displaySpan = document.getElementById('lang-display');
    
    if (switchBtn) {
        const targetLang = lang === 'vi' ? 'en' : 'vi';
        switchBtn.setAttribute('onclick', `switchLanguage('${targetLang}')`);
        switchBtn.textContent = LANGUAGE_DATA[targetLang]['language_switch'];
    }

    if (displaySpan) {
        displaySpan.textContent = LANGUAGE_DATA[lang]['language_current'];
    }

    // C. D·ªãch c√°c ti√™u ƒë·ªÅ ph·∫ßn (placeholder cho c√°c div tr·ªëng)
    const sectionIds = ['overview', 'vision', 'lean-canvas', 'technology', 'strategy', 'market', 'financials', 'advantage'];
    sectionIds.forEach(id => {
        const titleKey = 'nav_' + id.replace('-', '_');
        const element = document.getElementById(id);
        if (element && element.tagName === 'DIV' && element.children.length === 0) {
            element.innerHTML = `<h2 class="text-3xl font-bold mb-6">${LANGUAGE_DATA[lang][titleKey]}</h2><p>Content for this section will be translated inside ${id}.html.</p>`;
        }
    });
}


// Ch·∫°y h√†m import khi DOM s·∫µn s√†ng
document.addEventListener('DOMContentLoaded', importSections);
