// assets/js/importSections.js

/**
 * ðŸ‡»ðŸ‡³ VIETNAMESE TO ðŸ‡¬ðŸ‡§ ENGLISH TRANSLATION DICTIONARY
 * * Centralized dictionary for translating static text, section titles,
 * and the page title. Content for individual sections (e.g., overview.html) 
 * should be handled by giving translated elements a 'data-key' attribute
 * inside their respective HTML files, which will be processed by applyTranslations.
 */
const LANGUAGE_DATA = {
    'vi': {
        // Global/Header
        'page_title': 'Vicinity Safety | CÃ´ng Nghá»‡ Dáº­p Lá»­a ChÃ­nh XÃ¡c VFEP',
        'header_title': 'TÃ i liá»‡u Káº¿ hoáº¡ch Kinh doanh',
        'language_switch': 'English', // Text *on* the button
        'language_current': 'VN', // Displayed language

        // Section Titles (Used for Navigation/Headings)
        'nav_overview': 'Tá»•ng quan',
        'nav_vision': 'Táº§m nhÃ¬n & Sá»© má»‡nh',
        'nav_lean_canvas': 'MÃ´ hÃ¬nh Lean Canvas',
        'nav_technology': 'CÃ´ng nghá»‡',
        'nav_strategy': 'Chiáº¿n lÆ°á»£c',
        'nav_market': 'PhÃ¢n tÃ­ch Thá»‹ trÆ°á»ng',
        'nav_financials': 'TÃ i chÃ­nh',
        'nav_advantage': 'Lá»£i tháº¿ Cáº¡nh tranh',
        
        // Footer
        'footer_text': 'Â© 2024 Vicinity Safety. Báº£o lÆ°u má»i quyá»n.',
    },
    'en': {
        // Global/Header
        'page_title': 'Vicinity Safety | Precise Fire Extinguishing Technology VFEP',
        'header_title': 'Business Plan Document',
        'language_switch': 'Tiáº¿ng Viá»‡t', // Text *on* the button
        'language_current': 'EN', // Displayed language

        // Section Titles (Used for Navigation/Headings)
        'nav_overview': 'Overview',
        'nav_vision': 'Vision & Mission',
        'nav_lean_canvas': 'Lean Canvas Model',
        'nav_technology': 'Technology',
        'nav_strategy': 'Strategy',
        'nav_market': 'Market Analysis',
        'nav_financials': 'Financials',
        'nav_advantage': 'Competitive Advantage',

        // Footer
        'footer_text': 'Â© 2024 Vicinity Safety. All rights reserved.',
    }
};

let currentLang = localStorage.getItem('lang') || 'vi';

/**
 * Loads content from HTML files into the corresponding container IDs.
 * (Original logic for section importing)
 */
async function importSections() {
    const sections = [
        'header', 'overview', 'vision', 'lean-canvas', 'technology', 
        'strategy', 'market', 'financials', 'advantage', 'footer'
    ];

    for (const section of sections) {
        // Use a placeholder path for header/footer and sections
        const path = section === 'header' || section === 'footer' 
            ? `sections/${section}.html` 
            : `sections/${section}.html`;

        try {
            const response = await fetch(path);
            if (response.ok) {
                const html = await response.text();
                document.getElementById(section).innerHTML = html;
            } else {
                console.error(`Failed to load section: ${path}`);
            }
        } catch (error) {
            console.error(`Error fetching section ${section}:`, error);
        }
    }
    
    // AFTER sections are loaded, apply the current language
    applyTranslations(currentLang);
}


/**
 * Core function to switch the active language.
 * @param {string} lang - The target language ('vi' or 'en').
 */
window.switchLanguage = function(lang) {
    if (lang === currentLang) return; // Prevent unnecessary reloads

    currentLang = lang;
    localStorage.setItem('lang', lang);
    
    // 1. Update global HTML attributes
    document.documentElement.lang = lang;
    document.title = LANGUAGE_DATA[lang]['page_title'];

    // 2. Apply translations to all loaded content
    applyTranslations(lang);
    
    // Optional: Reload the current view/tab if needed (not implemented here)
};

/**
 * Finds all translatable elements and updates their content.
 * Looks for: 
 * 1. Elements with 'data-key' attribute (for content loaded via fetch)
 * 2. Elements with 'data-lang-title' attribute (for dynamic elements like button text)
 * 3. Updates the language switch button text/display.
 * @param {string} lang - The target language ('vi' or 'en').
 */
function applyTranslations(lang) {
    // A. Translate static/fetched content using data-key
    document.querySelectorAll('[data-key]').forEach(element => {
        const key = element.getAttribute('data-key');
        const translation = LANGUAGE_DATA[lang][key];
        if (translation) {
            element.textContent = translation;
        }
    });

    // B. Update Language Switch Button/Display
    const switchBtn = document.getElementById('language-switch-btn');
    const displaySpan = document.getElementById('lang-display');
    
    if (switchBtn) {
        // Set the target language for the button click
        const targetLang = lang === 'vi' ? 'en' : 'vi';
        switchBtn.setAttribute('onclick', `switchLanguage('${targetLang}')`);
        
        // Update the button's text to show what language it *switches to*
        switchBtn.textContent = LANGUAGE_DATA[targetLang]['language_switch'];
    }

    if (displaySpan) {
        // Update the visible language display (e.g., 'VN' or 'EN')
        displaySpan.textContent = LANGUAGE_DATA[lang]['language_current'];
    }

    // C. Translate the section titles for the main index (since they are empty divs)
    const sectionIds = ['overview', 'vision', 'lean-canvas', 'technology', 'strategy', 'market', 'financials', 'advantage'];
    sectionIds.forEach(id => {
        const titleKey = 'nav_' + id.replace('-', '_');
        const element = document.getElementById(id);
        if (element && element.tagName === 'DIV' && element.children.length === 0) {
            // Placeholder content for the empty divs in index.html, showing the translated title
            element.innerHTML = `<h2 class="text-3xl font-bold mb-6">${LANGUAGE_DATA[lang][titleKey]}</h2><p>Content for this section will be translated inside ${id}.html.</p>`;
        }
    });
}


// Run the import function when the DOM is ready
document.addEventListener('DOMContentLoaded', importSections);
